# This workflow uses actions that are not certified by GitHub.
# They are provided by a third-party and are governed by
# separate terms of service, privacy policy, and support
# documentation.

# This workflow will install Deno then run Deno lint and test.
# For more information see: https://github.com/denoland/setup-deno

name: Deno

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  lint:
    needs: build
    runs-on: ubuntu-latest
    container:
      # xxx instead use branch name and tag for current pipeline
      image: ghcr.io/${{ github.repository }}:$GITHUB_REF_NAME@$GITHUB_SHA
    steps:
    - name: Setup repo
      uses: actions/checkout@v2
      # pwd == /__w/dyno/dyno
    - run: /app/lint


  # If your tests *don't* require pkgs or non-repo files from your docker build image,
  # then you can use this nicely for testing files in your repo like 'test/something.test.js'
  # along with a full code coverage report.
  test:
    needs: build
    runs-on: ubuntu-latest
    container:
      # xxx instead use branch name and tag for current pipeline
      image: ghcr.io/internetarchive/dyno:main
    steps:
    - name: Setup repo
      uses: actions/checkout@v2
      # pwd == /__w/dyno/dyno
    - run: /app/test/test.sh
